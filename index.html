<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Quiz Portal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: Arial, sans-serif;
      margin:0; padding:0;
     background:linear-gradient(135deg,#162b34,#35819b,#2c5364); color:white; flex-direction:column; text-align:center; 
      display:flex;
      height:100vh;
      flex-direction: row;
    }
      
  section { display:none; height:100vh; display:flex; justify-content:center; align-items:center; }

    /* Sidebar */
    .sidebar {
      width:250px;
      background: linear-gradient(45deg,rgb(238, 246, 255),rgb(208, 246, 255),rgb(225, 246, 255),rgb(215, 246, 255),rgb(200, 246, 255),rgb(150, 246, 255));
      box-shadow:2px 0 8px rgba(0,0,0,0.1);
      padding:20px;
      display:none; /* hidden until login */
      flex-direction:column;
      justify-content:flex-start;
      align-items:flex-start;
      flex-shrink:0;
      box-sizing: border-box;
    }
    .sidebar h3 {
      margin-bottom:20px;
      color:#0a0a0a;
      text-align: left;
      font-size: medium;
    }
    .sidebar p {
      margin:8px 0;
      font-size:14px;
      color:#0d0d0d;
      word-wrap: break-word;
      word-break: break-word; /* ✅ prevent overflow */
      text-align: left;
    }

    /* Main content */
    .main {
      flex:1;
      display:flex;
      justify-content:center;
      align-items:center;
      padding:15px;
      width:100%;
      box-sizing:border-box;
    }
    .login-box { background:rgba(255,255,255,0.1); padding:30px; border-radius:12px; width:400px; text-align:center; box-shadow:0 0 20px rgba(0,0,0,0.4); }

    

    input {
      width:90%; padding:10px;
      margin:10px 0;
      border:1px solid #ccc;
      border-radius:5px;
      font-size:16px;
    }
    #loginBtn{ width:40%; padding:12px; background:linear-gradient(90deg,#ff8c00,#ff0080); border:none; border-radius:8px; color:white; font-weight:bold; font-size:1rem; cursor:pointer; }
    button {
      padding:10px 20px;
      background:#4a90e2;
      color:#fff;
      border:none;
      border-radius:5px;
      cursor:pointer;
      font-size:16px;
    }
    button:hover {background:#357ab7;}
    #error {color:rgb(192, 41, 41); margin-top:10px;
            }

    .quiz-box, .result-box, .start-box {display:none;}
    .question {font-size:18px; margin:20px 0;}
    .options button {
      display:inline-block;
      width:45%;
      margin:8px 2%;
      background:#1e1e1e;
      color:#fff;
      border:1px solid #0e0b0b;
      border-radius:5px;
      padding:10px;
      cursor:pointer;
      font-size:15px;
    }
    .options button:hover {background:#444;}
    #timer {
      font-weight:bold;
      font-size:20px;
      margin:10px;
    }
    .timer-green {color:green;
                  background-color: #dcd5d5;}
    .red-blink {color:red; animation: blink 1s infinite;
                background-color: #dcd5d5;}
    @keyframes blink {50% {opacity:0;}}

    /* Loading spinner */
    .spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #4a90e2;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      animation: spin 1s linear infinite;
      margin: 10px auto;
      display:none;
    }
    @keyframes spin { 0% { transform: rotate(0deg);} 100% { transform: rotate(360deg);} }

    /* ========== RESPONSIVE DESIGN ========== */
    @media (max-width: 900px) {
      body { flex-direction: column; } /* Sidebar becomes top bar */
      .sidebar {
        
        width:100%;
        flex-direction: row;
        flex-wrap: wrap;
        justify-content: space-around;
        padding:15px;
        text-align:center;
        box-shadow: 0 2px 8px rgba(10, 10, 10, 0.1);
      }
      .sidebar h3 { display:none; }
      .sidebar p {
        margin:10px;
        font-size:13px;
        flex: 1 1 30%;
        text-align: center;
      }
      .main { padding:10px; width:100%; }
      .card { width:100%; max-width:100%; padding:20px; margin:auto; }
      .options button { width:100%; margin:8px 0; }
    }

    @media (max-width: 480px) {
      .question { font-size:16px; }
      #timer { font-size:18px; }
      input, button { font-size:14px; }
      .options button { font-size:14px; padding:8px; }
    }
  </style>
</head>
<body>

<!-- SIDEBAR -->
<div class="sidebar" id="sidebar">
  <h3>Student Info</h3>
  <p><b>Reg ID:</b> <span id="sideReg"></span></p>
  <p><b>Name:</b> <span id="sideName"></span></p>
  <p><b>Department:</b> <span id="sideDept"></span></p>
</div>

<!-- MAIN CONTENT -->
<div class="main">
  <!-- LOGIN PAGE -->
  <div class="center-box login-box">
    <div class="card">
      <h2>Welcome to  <strong> QUIZ PORTAL.</strong></h2>
      <h3>ROUND 1</h3>
      <input type="text" id="regId" placeholder="Register Number" required>
      <input type="password" id="password" placeholder="Password" required>
      <button id="loginBtn" onclick="login()">Login</button>
      <div class="spinner" id="loginSpinner"></div>
      <p id="error"></p>
    </div>
  </div>

  <!-- START PAGE -->
  <div class="center-box start-box">
    <div class="card">
      <h2>Welcome <span id="studentName"></span></h2>
      <p>Click below to start your quiz.</p>
      <button id="startBtn" onclick="startQuiz()">Start Quiz</button>
      <p style="font-size:15px;color:#d3d01d;margin-top:10px">
        <b>The quiz will run in fullscreen mode. Exiting fullscreen, switching tabs/apps, or minimizing will end the quiz with 0 marks. And You will <span  style="color: red;">Eliminated</span> from the Round.</b>
      </p>
    </div>
  </div>

  <!-- QUIZ PAGE -->
  <div class="center-box quiz-box">
    <div class="card">
      <div id="timer" class="timer-green">Time: 20s</div>
      <div class="question" id="question"></div>
      <div class="options" id="options"></div>
    </div>
  </div>

  <!-- RESULT PAGE -->
   <div class="center-box result-box">
    <div class="card">
      <h2>Quiz Completed</h2>
      <p id="score"></p> <!-- Removed visible score text -->
      <p style="color: yellow;">Your attempt has been submitted successfully.</p>
    </div>
  </div>
  
</div>
<!-- FOOTER -->
<footer style="
  width: 100%;
  text-align: center;
  padding: 12px 0;
  background: rgba(255, 255, 255, 0.1);
  color: #ffffff;
  font-size: 14px;
  position: fixed;
  bottom: 0;
  left: 0;
  backdrop-filter: blur(5px);
  border-top: 1px solid rgba(255,255,255,0.2);
">
  Developed with ❤️ by <b>BALAJI </b>
</footer>

<script>
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwfO0IdBZLnw-l_WeH6ioFeJ0F9JmijiEgZCH9XJJAgtC6Ncotday8TbCyqnq_vAK38/exec"; // your Apps Script URL

  // ====== Quiz Questions ======
  
  const quizData = [
    
  
  { question: "Which file holds project dependencies in Node.js?", options: ["package.json", "node.json", "app.js", "index.js"], answer: "package.json" },
  { question: "Which component is used to display a scrollable list in Android?", options: ["CardView", "RecyclerView", "ImageView", "ConstraintLayout"], answer: "RecyclerView" },
  { question: "Which programming language is mainly used with Flutter?", options: [ "Python", "Java","Dart", "Swift"], answer: "Dart" },
  { question: "Which tool is commonly used for UI/UX design?", options: [ "VS Code","Figma", "Xcode", "Eclipse"], answer: "Figma" },
  { question: "Which tag defines a table row?", options: ["<tr>", "<td>", "<th>", "<table>"], answer: "<tr>" },
  { question: "What is the main goal of UX design?", options: [ "Making visuals attractive", "Increasing page load speed", "Reducing app size","Improving user satisfaction"], answer: "Improving user satisfaction" },
  { question: "Which Flutter widget is used for scrolling content?", options: [ "ScrollView", "Recycler","ListView", "ScrollPane"], answer: "ListView" },

  { question: "Which programming language is primarily used for Android app development?", options: ["Swift", "Kotlin", "PHP", "Ruby"], answer: "Kotlin" },
  { question: "Which keyword is used to import modules in Node.js?", options: [ "import", "use","require", "include"], answer: "require" },
  { question: "Which HTML tag defines the largest heading?", options: [ "<h6>", "<header>", "<head>","<h1>"], answer: "<h1>" },
  { question: "Which Visual Studio extension helps with Git integration?", options: ["GitHub Extension", "Docker Tools", "ReSharper", "Azure Tools"], answer: "GitHub Extension" },
  { question: "Which file defines the layout of an Android activity?", options: [ "layout.json", "activity_main.xml","AndroidManifest.xml", "gradle.build"], answer: "activity_main.xml" },
  { question: "Hot reload in Flutter allows you to:", options: [ "Reinstall dependencies", "Reset app data", "Update UI without restarting the app","Recompile from scratch"], answer: "Update UI without restarting the app" },
  { question: "Which company developed Visual Studio?", options: ["Microsoft", "Apple", "Google", "Adobe"], answer: "Microsoft" },
  { question: "Which command starts a new React Native project?", options: [ "npm start", "expo build", "yarn install","npx react-native init"], answer: "npx react-native init" },

  
  { question: "Which Node.js module is used to create a server?", options: [ "fs", "os", "http","url"], answer: "http" },
  { question: "Which company created React Native?", options: [ "Google","Meta (Facebook)", "Apple", "Microsoft"], answer: "Meta (Facebook)" },
  { question: "What file holds app dependencies in Flutter?", options: ["pubspec.yaml", "package.json", "build.gradle", "manifest.json"], answer: "pubspec.yaml" },
  { question: "Which symbol is used to reference an id in CSS?", options: [ "@", ".","#", "!"], answer: "#" },
  { question: "Which Android Studio tool is used for debugging?", options: [ "Profiler", "ADB", "Emulator","Logcat"], answer: "Logcat" },

  { question: "Which attribute is used to open a link in a new tab?", options: [ "open=\"tab\"","target=\"_blank\"", "newtab", "href=\"new\""], answer: "target=\"_blank\"" },
  { question: "Which programming language is used to write React Native apps?", options: ["JavaScript", "C++", "Python", "Swift"], answer: "JavaScript" },

  { question: "What does UI stand for in UI/UX?", options: ["User Interface", "Unified Interface", "User Internet", "Universal Interaction"], answer: "User Interface" },
  { question: "How do you center text in CSS?", options: [ "align: middle;", "position: center;", "margin: auto;","text-align: center;"], answer: "text-align: center;" },
  { question: "Which property changes the text color in CSS?", options: [ "font-color", "fgcolor","color", "text-color"], answer: "color" },
  { question: "Which file in React Native stores package dependencies?", options: [ "gradle.build", "app.js","package.json", "manifest.json"], answer: "package.json" },
  { question: "Which command is used to create a new Flutter project?", options: [ "flutter start", "flutter new", "flutter init","flutter create"], answer: "flutter create" },
  { question: "Which HTML tag is used to create a hyperlink?", options: ["<a>", "<url>", "<link>", "<href>"], answer: "<a>" },
  { question: "Wireframes are mainly used to:", options: [ "Create animations", "Plan app layout","Write backend code", "Add color schemes"], answer: "Plan app layout" },
  { question: "Which Node.js function is used to print to console?", options: [ "print()", "echo()", "console.log()","display()"], answer: "console.log()" },
  { question: "Which file format is used for Android app installation?", options: ["ZIP", "APK", "EXE", "IPA"], answer: "APK" },
  { question: "Which principle focuses on ease of navigation?", options: ["Usability", "Aesthetics", "Typography", "Contrast"], answer: "Usability" },
  { question: "Which Flutter widget is used for layouts?", options: [ "Frame", "RecyclerView", "TableView","Container"], answer: "Container" },

  { question: "Which programming language is primarily used for Android app development?", options: [ "PHP", "Ruby", "Swift","Kotlin"], answer: "Kotlin" },
  { question: "Which Visual Studio feature helps find and fix code issues automatically?", options: ["Code Analyzer", "Live Share", "Debugger", "IntelliSense"], answer: "Code Analyzer" },
  { question: "What does HTML stand for?", options: ["HyperText Markup Language", "HighText Machine Language", "Home Tool Markup Language", "Hyper Tool Multi Language"], answer: "HyperText Markup Language" },
  { question: "Which color model is primarily used for digital UI design?", options: [ "CMYK","RGB", "HSB", "LAB"], answer: "RGB" },
  { question: "Which command installs all dependencies in Node.js?", options: [ "npm start", "npm build", "node install","npm install"], answer: "npm install" },
  { question: "Which tag is used to display an image in HTML?", options: [ "<image>", "<picture>","<img>", "<src>"], answer: "<img>" },
  { question: "Which file format represents a Visual Studio solution?", options: [".sln", ".csproj", ".vsproj", ".dll"], answer: ".sln" },
  { question: "Which AndroidManifest.xml purpose?", options: [ "To manage Gradle dependencies", "To design layouts", "To store user data","To declare app components"], answer: "To declare app components" },
  { question: "Which Node.js engine is used?", options: ["V8", "SpiderMonkey", "Chakra", "Nashorn"], answer: "V8" },
  { question: "Which component is used for text display in React Native?", options: [ "Paragraph","Text", "Typography", "Label"], answer: "Text" },


  { question: "Which Android Studio tool is used for debugging?", options: [ "Profiler","Logcat", "ADB", "Emulator"], answer: "Logcat" },
  { question: "Which company created React Native?", options: ["Meta (Facebook)", "Google", "Apple", "Microsoft"], answer: "Meta (Facebook)" },
  { question: "Which Flutter file holds dependencies?", options: [ "package.json", "build.gradle", "manifest.json","pubspec.yaml"], answer: "pubspec.yaml" },
  { question: "Which symbol is used to reference an id in CSS?", options: [ "@", ".","#", "!"], answer: "#" },
  { question: "Which company developed Visual Studio?", options: [ "Apple", "Microsoft","Google", "Adobe"], answer: "Microsoft" },

  { question: "Which Node.js module is used to create a server?", options: ["http", "fs", "os", "url"], answer: "http" },
  { question: "Hot reload in Flutter allows you to:", options: [ "Reinstall dependencies", "Reset app data","Update UI without restarting the app","Recompile from scratch"], answer: "Update UI without restarting the app" }
];

  // ====== State ======
  let currentQ = 0, score = 0, timer, timeLeft = 20;
  let quizActive = false;
  let hasSubmitted = false; // prevent duplicate submits
  let sessionToken = null;  // from server at login

  // ====== Helpers: Fullscreen ======
  function enterFullscreen() {
    const el = document.documentElement;
    if (el.requestFullscreen) el.requestFullscreen();
    else if (el.mozRequestFullScreen) el.mozRequestFullScreen();
    else if (el.webkitRequestFullscreen) el.webkitRequestFullscreen();
    else if (el.msRequestFullscreen) el.msRequestFullscreen();
  }
  function isFullscreen() {
    return document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement || document.msFullscreenElement;
  }

  // ====== Login ======
  function login() {
    const regId = document.getElementById("regId").value.trim();
    const password = document.getElementById("password").value.trim();
    const spinner = document.getElementById("loginSpinner");
    const err = document.getElementById("error");
    err.innerText = "";
    spinner.style.display = "block";
    document.getElementById("loginBtn").disabled = true;

    fetch(SCRIPT_URL, {
      method: "POST",
      body: JSON.stringify({ action: "login", regId, password })
    })
    .then(res => res.json())
    .then(data => {
      spinner.style.display = "none";
      document.getElementById("loginBtn").disabled = false;

      if (data.status === "success") {
        sessionToken = data.token; // ✅ token from server
        localStorage.setItem("regId", regId);
        localStorage.setItem("name", data.name);
        localStorage.setItem("dept", data.dept);
        localStorage.setItem("token", sessionToken);

        // Show start screen
        document.querySelector(".login-box").style.display = "none";
        document.getElementById("studentName").innerText = `${data.name} (${regId})`;
        document.querySelector(".start-box").style.display = "flex";

        // Show sidebar
        document.getElementById("sidebar").style.display = "flex";
        document.getElementById("sideReg").innerText = regId;
        document.getElementById("sideName").innerText = data.name;
        document.getElementById("sideDept").innerText = data.dept;

      } else if (data.status === "already") {
        // Already attempted → Block re-login
        document.querySelector(".login-box .card").innerHTML =
          `<h2>Attempt Recorded</h2><p>You have already completed this quiz.</p>`;
      } else {
        err.innerText = "Invalid Register No or Password!";
      }
    })
    .catch(() => {
      spinner.style.display = "none";
      document.getElementById("loginBtn").disabled = false;
      err.innerText = "Server Error!";
    });
  }

  // ====== Start Quiz ======
  function startQuiz() {
    // Move to quiz UI
    document.querySelector(".start-box").style.display = "none";
    document.querySelector(".quiz-box").style.display = "flex";
    quizActive = true;
    hasSubmitted = false;
    score = 0;
    currentQ = 0;

    // Enter fullscreen (cannot hide OS buttons, but we enforce fail if exit)
    enterFullscreen();

    loadQuestion();
  }

  document.addEventListener("keydown", (e) => { if (e.key === "Enter") document.getElementById("loginBtn").click(); });
  
  // ====== Load Question ======
  function loadQuestion() {
    if (currentQ >= quizData.length) {
      showResult(false);
      return;
    }

    document.getElementById("question").innerText =
      `Question ${currentQ+1}: ${quizData[currentQ].question}`;

    const optionsDiv = document.getElementById("options");
    optionsDiv.innerHTML = "";
    quizData[currentQ].options.forEach(opt => {
      const btn = document.createElement("button");
      btn.innerText = opt;
      btn.onclick = () => checkAnswer(opt);
      optionsDiv.appendChild(btn);
    });

    resetTimer();
  }

  // ====== Timer ======
  function resetTimer() {
    clearInterval(timer);
    timeLeft = 20;
    updateTimerDisplay();

    timer = setInterval(() => {
      timeLeft--;
      updateTimerDisplay();
      if (timeLeft <= 0) {
        clearInterval(timer);
        currentQ++;
        loadQuestion();
      }
    }, 1000);
  }

  function updateTimerDisplay() {
    const timerEl = document.getElementById("timer");
    timerEl.innerText = `Time: ${timeLeft}s`;
    timerEl.classList.remove("red-blink","timer-green");
    if (timeLeft <= 8) timerEl.classList.add("red-blink");
    else timerEl.classList.add("timer-green");
  }

  // ====== Answer Check ======
  function checkAnswer(answer) {
    if (answer === quizData[currentQ].answer) score++;
    currentQ++;
    clearInterval(timer);
    loadQuestion();
  }

  // ====== Show Result & Submit ======
  function showResult(forcedEnd = false) {
    if (hasSubmitted) return; // prevent duplicate calls
    hasSubmitted = true;

    // Stop everything
    clearInterval(timer);
    quizActive = false;

    // If forced end (cheating), override score to 0
    if (forcedEnd) score = 0;

    // UI
    document.querySelector(".quiz-box").style.display = "none";
    document.querySelector(".result-box").style.display = "flex";
    //document.getElementById("score").innerText =
      //`Your Score: ${score}/${quizData.length}`;

    // Data for server
    const regId = localStorage.getItem("regId");
    const token = localStorage.getItem("token") || sessionToken;

    // Submit score with token
    fetch(SCRIPT_URL, {
      method: "POST",
      body: JSON.stringify({
        action: "submitScore",
        regId,
        score,
        token,
        forced: !!forcedEnd
      })
    }).catch(()=>{ /* swallow network errors for UI */ });

    // Attempt to exit fullscreen if still in it
    if (isFullscreen()) {
      if (document.exitFullscreen) document.exitFullscreen();
      else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
      else if (document.mozCancelFullScreen) document.mozCancelFullScreen();
      else if (document.msExitFullscreen) document.msExitFullscreen();
    }
  }

  // ====== Force Fail (security triggers) ======
  function forceFail() {
    if (!quizActive) return;
    showResult(true); // will set score = 0 and submit
  }

  // ====== Security Event Listeners ======
  // 1) Leaving fullscreen
  document.addEventListener("fullscreenchange", () => {
    if (quizActive && !isFullscreen()) forceFail();
  });
  document.addEventListener("webkitfullscreenchange", () => {
    if (quizActive && !isFullscreen()) forceFail();
  });
  document.addEventListener("mozfullscreenchange", () => {
    if (quizActive && !isFullscreen()) forceFail();
  });
  document.addEventListener("MSFullscreenChange", () => {
    if (quizActive && !isFullscreen()) forceFail();
  });

  // 2) Tab change / minimize
  document.addEventListener("visibilitychange", () => {
    if (quizActive && document.hidden) forceFail();
  });

  // 3) Window blur (focus lost – often indicates app switch)
  window.addEventListener("blur", () => {
    if (quizActive) forceFail();
  });

  // 4) Close/refresh attempt during quiz
  window.addEventListener("beforeunload", (e) => {
    if (quizActive) {
      // Modern browsers ignore custom text, but this prevents silent refresh.
      e.preventDefault();
      e.returnValue = '';
      forceFail();
    }
  });
//Mouse disable button
  document.addEventListener("contextmenu", (e) => e.preventDefault());

</script>

</body>
</html>

