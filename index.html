<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Quiz Portal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="brainbuzz.png" type="image/png" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin:0; padding:0;
      background:linear-gradient(135deg,#162b34,#35819b,#2c5364);
      color:white; flex-direction:column; text-align:center; 
      display:flex;
      height:100vh;
      flex-direction: row;
    }
      
    section { display:none; height:100vh; display:flex; justify-content:center; align-items:center; }

    /* Sidebar */
    .sidebar {
      width:250px;
      background: linear-gradient(45deg,rgb(238, 246, 255),rgb(208, 246, 255),rgb(225, 246, 255),rgb(215, 246, 255),rgb(200, 246, 255),rgb(150, 246, 255));
      box-shadow:2px 0 8px rgba(0,0,0,0.1);
      padding:20px;
      display:none; /* hidden until login */
      flex-direction:column;
      justify-content:flex-start;
      align-items:flex-start;
      flex-shrink:0;
      box-sizing: border-box;
    }
    .sidebar h3 {
      margin-bottom:20px;
      color:#0a0a0a;
      text-align: left;
      font-size: medium;
    }
    .sidebar p {
      margin:8px 0;
      font-size:14px;
      color:#0d0d0d;
      word-wrap: break-word;
      word-break: break-word;
      text-align: left;
    }

    /* Main content */
    .main {
      flex:1;
      display:flex;
      justify-content:center;
      align-items:center;
      padding:15px;
      width:100%;
      box-sizing:border-box;
    }
    .login-box { background:rgba(255,255,255,0.1); padding:30px; border-radius:12px; width:400px; text-align:center; box-shadow:0 0 20px rgba(0,0,0,0.4); }

    input {
      width:90%; padding:10px;
      margin:10px 0;
      border:1px solid #ccc;
      border-radius:5px;
      font-size:16px;
    }
    #loginBtn{ width:40%; padding:12px; background:linear-gradient(90deg,#ff8c00,#ff0080); border:none; border-radius:8px; color:white; font-weight:bold; font-size:1rem; cursor:pointer; }
    button {
      padding:10px 20px;
      background:#4a90e2;
      color:#fff;
      border:none;
      border-radius:5px;
      cursor:pointer;
      font-size:16px;
    }
    button:hover {background:#357ab7;}
    #error {color:rgb(192, 41, 41); margin-top:10px;}

    .quiz-box, .result-box, .start-box {display:none;}
    .question {font-size:18px; margin:20px 0;}
    .options button {
      display:inline-block;
      width:45%;
      margin:8px 2%;
      background:#1e1e1e;
      color:#fff;
      border:1px solid #0e0b0b;
      border-radius:5px;
      padding:10px;
      cursor:pointer;
      font-size:15px;
    }
    .options button:hover {background:#444;}
    #timer {
      font-weight:bold;
      font-size:20px;
      margin:10px;
    }
    .timer-green {color:green; background-color: #dcd5d5;}
    .red-blink {color:red; animation: blink 1s infinite; background-color: #dcd5d5;}
    @keyframes blink {50% {opacity:0;}}

    /* Loading spinner */
    .spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #4a90e2;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      animation: spin 1s linear infinite;
      margin: 10px auto;
      display:none;
    }
    @keyframes spin { 0% { transform: rotate(0deg);} 100% { transform: rotate(360deg);} }

    /* RESPONSIVE DESIGN */
    @media (max-width: 900px) {
      body { flex-direction: column; }
      .sidebar { width:100%; flex-direction: row; flex-wrap: wrap; justify-content: space-around; padding:15px; text-align:center; box-shadow: 0 2px 8px rgba(10, 10, 10, 0.1); }
      .sidebar h3 { display:none; }
      .sidebar p { margin:10px; font-size:13px; flex: 1 1 30%; text-align: center; }
      .main { padding:10px; width:100%; }
      .card { width:100%; max-width:100%; padding:20px; margin:auto; }
      .options button { width:100%; margin:8px 0; }
    }
    @media (max-width: 480px) {
      .question { font-size:16px; }
      #timer { font-size:18px; }
      input, button { font-size:14px; }
      .options button { font-size:14px; padding:8px; }
    }
  </style>
</head>
<body>

<!-- SIDEBAR -->
<div class="sidebar" id="sidebar">
  <h3>Student Info</h3>
  <p><b>Reg ID:</b> <span id="sideReg"></span></p>
  <p><b>Name:</b> <span id="sideName"></span></p>
  <p><b>Dept:</b> <span id="sideDept"></span></p>
</div>

<!-- MAIN CONTENT -->
<div class="main">
  <!-- LOGIN PAGE -->
  <div class="center-box login-box">
    <div class="card">
      <h2>Welcome to <strong>BRAIN BUZZ</strong></h2>
      <h3>ROUND 2</h3>
      <input type="text" id="regId" placeholder="Register Number" required>
      <input type="password" id="password" placeholder="Password" required>
      <button id="loginBtn" onclick="login()">Login</button>
      <div class="spinner" id="loginSpinner"></div>
      <p id="error"></p>
    </div>
  </div>

  <!-- START PAGE -->
  <div class="center-box start-box">
    <div class="card">
      <h2>Welcome <span id="studentName"></span></h2>
      <p>Click below to start your quiz.</p>
      <button id="startBtn" onclick="startQuiz()">Start Quiz</button>
      <p style="font-size:15px;color:#d3d01d;margin-top:10px">
        <b>The quiz will run in fullscreen mode. Exiting fullscreen, switching tabs/apps, or minimizing will end the quiz with 0 marks. And You will <span  style="color: red;">Eliminated</span> from the Round.</b>
      </p>
    </div>
  </div>

  <!-- QUIZ PAGE -->
  <div class="center-box quiz-box">
    <div class="card">
      <div id="timer" class="timer-green">Time: 20s</div>
      <div class="question" id="question"></div>
      <div class="options" id="options"></div>
    </div>
  </div>

  <!-- RESULT PAGE -->
  <div class="center-box result-box">
    <div class="card">
      <h2>Quiz Completed</h2>
      <p id="score"></p> <!-- Removed visible score text -->
      <p style="color: yellow;">Your attempt has been submitted successfully.</p>
    </div>
  </div>
</div>

<script>
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxsQ_XX7DBOPKjvmDpLqIRQwMeg5CJhF2jUSk48ASGFH_69F2BqWliAfCDe1aK6Dv2P/exec"; 

  // ====== Quiz Questions ======
  const quizData = [
    // ---------------- CODE-BASED OUTPUT QUESTIONS (35) ----------------

  // 游릭 EASY (10)
  { question: `What is the output of the following code?

#include <stdio.h>

int main() {
    int a = 5;
    int b = 2;
    printf("%d", a + b);
    return 0;
}`,
    options: ["7", "52", "Error", "Undefined"], answer: "7" },

  { question: `What is the output of the following code?

#include <stdio.h>

int main() {
    char c = 'A';
    printf("%c", c);
    return 0;
}`,
    options: ["A", "65", "B", "Error"], answer: "A" },

  { question: `What is the output of the following code?

#include <stdio.h>

int main() {
    int i;
    for(i=0; i<3; i++)
        printf("%d", i);
    return 0;
}`,
    options: ["012", "123", "321", "Error"], answer: "012" },

  { question: `Output of:

#include <stdio.h>

int main() {
    int x = 10;
    x++;
    printf("%d", x);
    return 0;
}`,
    options: ["10", "11", "9", "Error"], answer: "11" },

  { question: `Output:

#include <stdio.h>

int main() {
    int a = 5, b = 10;
    printf("%d", a>b);
    return 0;
}`,
    options: ["0", "1", "5", "10"], answer: "0" },

  { question: `Output:

#include <stdio.h>

int main() {
    printf("%d", 2*3+4);
    return 0;
}`,
    options: ["10", "14", "8", "Error"], answer: "10" },

  { question: `Output:

#include <stdio.h>

int main() {
    int x = 5;
    printf("%d", x--);
    return 0;
}`,
    options: ["5", "4", "6", "Error"], answer: "5" },

  { question: `Output:

#include <stdio.h>

int main() {
    printf("%d", 10/3);
    return 0;
}`,
    options: ["3", "3.33", "4", "Error"], answer: "3" },

  { question: `Output:

#include <stdio.h>

int main() {
    int a = 2;
    int b = 3;
    printf("%d", a*b);
    return 0;
}`,
    options: ["6", "5", "23", "Error"], answer: "6" },

  { question: `Output:

#include <stdio.h>

int main() {
    int a = 1;
    int b = 0;
    printf("%d", a && b);
    return 0;
}`,
    options: ["0", "1", "Error", "Undefined"], answer: "0" },

  // 游리 INTERMEDIATE (10)
  { question: `Output:

#include <stdio.h>

int main() {
    int arr[3] = {1,2,3};
    printf("%d", arr[1]);
    return 0;
}`,
    options: ["2", "1", "3", "Error"], answer: "2" },

  { question: `Output:

#include <stdio.h>

int main() {
    int a = 5;
    int *p = &a;
    printf("%d", *p);
    return 0;
}`,
    options: ["5", "Address of a", "0", "Error"], answer: "5" },

  { question: `Output:

#include <stdio.h>

int square(int x) {
    return x*x;
}

int main() {
    printf("%d", square(3));
    return 0;
}`,
    options: ["9", "6", "3", "Error"], answer: "9" },

  { question: `Output:

#include <stdio.h>

int main() {
    char str[] = "C";
    printf("%c", str[0]);
    return 0;
}`,
    options: ["C", "0", "Error", "Null"], answer: "C" },

  { question: `Output:

#include <stdio.h>

int main() {
    int x = 5, y = 10;
    if(x > y)
        printf("Yes");
    else
        printf("No");
    return 0;
}`,
    options: ["Yes", "No", "Error", "Undefined"], answer: "No" },

  { question: `Output:

#include <stdio.h>

int main() {
    int i=0;
    while(i<3) { 
      printf("%d", i); i++; }
      return 0;
}`,
    options: ["012", "123", "321", "Error"], answer: "012" },

  { question: `Output:

#include <stdio.h>

int main() {
    int x=5;
    printf("%d", ++x);
    return 0;
}`,
    options: ["5", "6", "4", "Error"], answer: "6" },

  { question: `Output:

#include <stdio.h>

int main() {
    int a=1, b=2, c=3;
    printf("%d", a>b ? b : c);
    return 0;
}`,
    options: ["1", "2", "3", "Error"], answer: "3" },

  { question: `Output:

#include <stdio.h>

int main() {
    int a=2, b=3;
    a += b;
    printf("%d", a);
    return 0;
}`,
    options: ["5", "2", "3", "6"], answer: "5" },

  { question: `Output:

#include <stdio.h>

int main() {
    int arr[2][2] = {{1,2},{3,4}};
    printf("%d", arr[1][0]);
    return 0;
}`,
    options: ["3", "2", "1", "4"], answer: "3" },

  // 游댮 ADVANCED (15)
  { question: `Output:

#include <stdio.h>

int main() {
    int x = 1;
    printf("%d %d", x++, ++x);
    return 0;
}`,
    options: ["1 3", "2 2", "Undefined behavior", "1 2"], answer: "Undefined behavior" },

  { question: `Output:

#include <stdio.h>

int main() {
    int a = 5;
    int *p = &a;
    *p = 10;
    printf("%d", a);
    return 0;
}`,
    options: ["5", "10", "Address", "Error"], answer: "10" },

  { question: `Output:

#include <stdio.h>

int main() {
    int x[3] = {1,2,3};
    printf("%d", *(x+2));
    return 0;
}`,
    options: ["3", "2", "1", "Error"], answer: "3" },

  { question: `Output:

#include <stdio.h>

int main() {
    int x=5;
    int y=0;
    printf("%d", x && y);
    return 0;
}`,
    options: ["0", "1", "5", "Error"], answer: "0" },

  { question: `Output:

#include <stdio.h>

void fun(int *a) { *a = 10; }

int main() {
    int x=5;
    fun(&x);
    printf("%d", x);
    return 0;
}`,
    options: ["5", "10", "Address", "Error"], answer: "10" },

  { question: `Output:

#include <stdio.h>

int main() {
    int a = 10;
    printf("%d", a >> 1);
    return 0;
}`,
    options: ["5", "20", "1", "Error"], answer: "5" },

  { question: `Output:

#include <stdio.h>

int main() {
    char c = 'A';
    printf("%d", c);
    return 0;
}`,
    options: ["65", "A", "66", "Error"], answer: "65" },

  { question: `Output:

#include <stdio.h>

int main() {
    int a=5, b=3;
    printf("%d", a|b);
    return 0;
}`,
    options: ["7", "1", "15", "8"], answer: "7" },

  { question: `Output:

#include <stdio.h>

int main() {
    int x=1;
    printf("%d", x<<2);
    return 0;
}`,
    options: ["4", "8", "2", "1"], answer: "4" },

  { question: `Output:

#include <stdio.h>

int main() {
    int x=5, y=3;
    printf("%d", x^y);
    return 0;
}`,
    options: ["6", "7", "8", "5"], answer: "6" },

  { question: `Output:

#include <stdio.h>

int main() {
    int x=0;
    printf("%d", !x);
    return 0;
}`,
    options: ["0", "1", "-1", "Error"], answer: "1" },

  { question: `Output:

#include <stdio.h>

int main() {
    int a=5, b=2;
    printf("%d", a%b);
    return 0;
}`,
    options: ["1", "2", "0", "Error"], answer: "1" },

  { question: `Output:

#include <stdio.h>

int main() {
    int a=1;
    if(a=0) 
      printf("Yes");
    else 
      printf("No");
    return 0;
}`,
    options: ["Yes", "No", "Error", "Undefined"], answer: "No" },

  { question: `Output:

#include <stdio.h>

int main() {
    int a=2, b=3;
    printf("%d", a*b++);
    return 0;
}`,
    options: ["6", "9", "5", "Error"], answer: "6" },

  { question: `Output:

#include <stdio.h>

int main() {
    int a=1, b=2, c;
    c = a++ + ++b;
    printf("%d", c);
    return 0;
}`,
    options: ["4", "5", "3", "6"], answer: "5" },

  // ---------------- NORMAL MCQs (15) ----------------

  // 游릭 EASY (5)
  { question: "Which of these is a valid identifier in C?", options: ["1var", "_var", "var-name", "#var"], answer: "_var" },
  { question: "Which of these is the correct syntax to declare an integer?", options: ["int a;", "integer a;", "int a()", "a int;"], answer: "int a;" },
  { question: "Which function is used to read a single character?", options: ["scanf()", "getchar()", "gets()", "printf()"], answer: "getchar()" },
  { question: "Which header file is used for standard input/output?", options: ["stdio.h", "conio.h", "stdlib.h", "string.h"], answer: "stdio.h" },
  { question: "Which operator is used to assign a value?", options: ["=", "==", "!", "+="], answer: "=" },

  // 游리 INTERMEDIATE (5)
  { question: "Which function returns length of a string?", options: ["strlen()", "size()", "length()", "count()"], answer: "strlen()" },
  { question: "Which keyword is used to declare a constant?", options: ["const", "final", "static", "define"], answer: "const" },
  { question: "Which operator is used for logical AND?", options: ["&&", "||", "!", "&"], answer: "&&" },
  { question: "Which function copies one string to another?", options: ["strcpy()", "strcat()", "strdup()", "copy()"], answer: "strcpy()" },
  { question: "Which storage class preserves value between function calls?", options: ["auto", "static", "extern", "register"], answer: "static" },

  // 游댮 ADVANCED (5)
  { question: "Which keyword prevents compiler optimization?", options: ["const", "volatile", "static", "extern"], answer: "volatile" },
  { question: "Which operator cannot be overloaded in C?", options: ["sizeof", "=", "+", "-"], answer: "sizeof" },
  { question: "Which function deallocates dynamic memory?", options: ["malloc()", "free()", "calloc()", "realloc()"], answer: "free()" },
  { question: "Which operator shifts bits to the right?", options: ["<<", ">>", "&", "|"], answer: ">>" },
  { question: "Which function returns file pointer position?", options: ["ftell()", "fseek()", "fpos()", "rewind()"], answer: "ftell()" }

  ];

  // ====== State ======
  let currentQ = 0, score = 0, timer, timeLeft = 30;
  let quizActive = false;
  let hasSubmitted = false; 
  let sessionToken = null;  

  function enterFullscreen() {
    const el = document.documentElement;
    if (el.requestFullscreen) el.requestFullscreen();
    else if (el.mozRequestFullScreen) el.mozRequestFullScreen();
    else if (el.webkitRequestFullscreen) el.webkitRequestFullscreen();
    else if (el.msRequestFullscreen) el.msRequestFullscreen();
  }
  function isFullscreen() {
    return document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement || document.msFullscreenElement;
  }

  function login() {
    const regId = document.getElementById("regId").value.trim();
    const password = document.getElementById("password").value.trim();
    const spinner = document.getElementById("loginSpinner");
    const err = document.getElementById("error");
    err.innerText = "";
    spinner.style.display = "block";
    document.getElementById("loginBtn").disabled = true;

    fetch(SCRIPT_URL, {
      method: "POST",
      body: JSON.stringify({ action: "login", regId, password })
    })
    .then(res => res.json())
    .then(data => {
      spinner.style.display = "none";
      document.getElementById("loginBtn").disabled = false;

      if (data.status === "success") {
        sessionToken = data.token; 
        localStorage.setItem("regId", regId);
        localStorage.setItem("name", data.name);
        localStorage.setItem("dept", data.dept);
        localStorage.setItem("token", sessionToken);

        document.querySelector(".login-box").style.display = "none";
        document.getElementById("studentName").innerText = `${data.name} (${regId})`;
        document.querySelector(".start-box").style.display = "flex";

        document.getElementById("sidebar").style.display = "flex";
        document.getElementById("sideReg").innerText = regId;
        document.getElementById("sideName").innerText = data.name;
        document.getElementById("sideDept").innerText = data.dept;

      } else if (data.status === "already") {
        document.querySelector(".login-box .card").innerHTML =
          `<h2>Attempt Recorded</h2><p>You have already completed this quiz.</p>`;
      } else {
        err.innerText = "Invalid Register No or Password!";
      }
    })
    .catch(() => { spinner.style.display = "none"; document.getElementById("loginBtn").disabled = false; err.innerText = "Server Error!"; });
  }

  function startQuiz() {
    document.querySelector(".start-box").style.display = "none";
    document.querySelector(".quiz-box").style.display = "flex";
    quizActive = true;
    hasSubmitted = false;
    score = 0;
    currentQ = 0;
    enterFullscreen();
    loadQuestion();
  }

  function loadQuestion() {
    if (currentQ >= quizData.length) {
      showResult(false);
      return;
    }
    document.getElementById("question").innerText = `Question ${currentQ+1}: ${quizData[currentQ].question}`;
    const optionsDiv = document.getElementById("options");
    optionsDiv.innerHTML = "";
    quizData[currentQ].options.forEach(opt => {
      const btn = document.createElement("button");
      btn.innerText = opt;
      btn.onclick = () => checkAnswer(opt);
      optionsDiv.appendChild(btn);
    });
    resetTimer();
  }

  function resetTimer() {
    clearInterval(timer);
    timeLeft = 30;
    updateTimerDisplay();
    timer = setInterval(() => {
      timeLeft--;
      updateTimerDisplay();
      if (timeLeft <= 0) {
        clearInterval(timer);
        currentQ++;
        loadQuestion();
      }
    }, 1000);
  }

  function updateTimerDisplay() {
    const timerEl = document.getElementById("timer");
    timerEl.innerText = `Time: ${timeLeft}s`;
    timerEl.classList.remove("red-blink","timer-green");
    if (timeLeft <= 8) timerEl.classList.add("red-blink");
    else timerEl.classList.add("timer-green");
  }

  // ====== Answer Check: +2 correct, -1 wrong ======
  function checkAnswer(answer) {
    if (answer === quizData[currentQ].answer) score += 2;
    else score -= 1;
    if(score<0) score=0;
    currentQ++;
    clearInterval(timer);
    loadQuestion();
  }

  function showResult(forcedEnd = false) {
    if (hasSubmitted) return;
    hasSubmitted = true;
    clearInterval(timer);
    quizActive = false;
    if (forcedEnd) score = 0;
    document.querySelector(".quiz-box").style.display = "none";
    document.querySelector(".result-box").style.display = "flex";

    const regId = localStorage.getItem("regId");
    const token = localStorage.getItem("token") || sessionToken;
    fetch(SCRIPT_URL, {
      method: "POST",
      body: JSON.stringify({
        action: "submitScore",
        regId,
        score,
        token,
        forced: !!forcedEnd
      })
    }).catch(()=>{});
    if (isFullscreen()) { if(document.exitFullscreen) document.exitFullscreen(); }
  }

  function forceFail() { if (!quizActive) return; showResult(true); }

  document.addEventListener("fullscreenchange", () => { if (quizActive && !isFullscreen()) forceFail(); });
  document.addEventListener("webkitfullscreenchange", () => { if (quizActive && !isFullscreen()) forceFail(); });
  document.addEventListener("mozfullscreenchange", () => { if (quizActive && !isFullscreen()) forceFail(); });
  document.addEventListener("MSFullscreenChange", () => { if (quizActive && !isFullscreen()) forceFail(); });

  document.addEventListener("visibilitychange", () => { if (quizActive && document.hidden) forceFail(); });
  window.addEventListener("blur", () => { if (quizActive) forceFail(); });
  window.addEventListener("beforeunload", (e) => { if (quizActive) { e.preventDefault(); e.returnValue = ''; forceFail(); } });
  document.addEventListener("contextmenu", (e) => e.preventDefault());
  document.addEventListener("keydown", (e) => { if (e.key === "Enter") document.getElementById("loginBtn").click(); });
</script>
</body>
</html>
